<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tous les jeux</title>
    <style>
        :root {
            --background: #f0f0f0;
            --text-color: #222;
            --card-bg: white;
            --card-shadow: 0 2px 5px rgba(0,0,0,0.1);
            --border-color: #ddd;
        }

        body.theme-dark {
            --background: #181a1b;
            --text-color: #f4f4f4;
            --card-bg: #23272b;
            --card-shadow: 0 2px 5px rgba(0,0,0,0.3);
            --border-color: #444;
        }

        body {
            font-family: sans-serif;
            background: var(--background);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        .game {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: transform 0.2s, background-color 0.3s;
            border: 1px solid var(--border-color);
            /* Remove flex and aspect-ratio from .game */
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Responsive game card adjustments */
        @media (max-width: 480px) {
            .game {
                border-radius: 6px;
            }
            
            .game-title {
                padding: 0.4rem;
                font-size: 0.9rem;
            }
            
            .new-badge {
                font-size: 0.7em;
                padding: 1px 8px;
                top: 5px;
                left: 5px;
            }
        }
        .game-cover {
            aspect-ratio: 0.73;
            width: 100%;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .game-cover img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #222;
            display: block;
        }
        .game-title {
            padding: 0.5rem;
            color: var(--text-color);
            background: var(--card-bg);
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: bold;
        }
        .game-link {
            text-decoration: none !important;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .theme-toggle {
            background: none;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .theme-toggle:hover {
            background: var(--text-color);
            color: var(--background);
        }
        .random-game-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .random-game-btn:hover {
            background-color: #45a049;
        }
        .browser-warning {
            background-color: #ffecb3;
            border-left: 4px solid #ff9800;
            padding: 12px 16px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: none; /* Hidden by default */
        }
        .browser-warning p {
            margin: 0;
            font-size: 0.95rem;
        }
        body.theme-dark .browser-warning {
            background-color: #664d00;
            color: #f4f4f4;
        }
        .game-new {
            border: 2.5px solid #ff9800 !important;
            box-shadow: 0 0 0 3px #fff6, 0 2px 8px #ff980055;
            position: relative;
        }
        .new-badge {
            position: absolute;
            top: 7px;
            left: 7px;
            background: linear-gradient(90deg, #ff9800, #ffc107);
            color: #fff;
            font-weight: bold;
            font-size: 0.82em;
            padding: 2px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px #ff980055;
            z-index: 2;
            letter-spacing: 1px;
            pointer-events: none;
        }
        
        /* Search functionality styles */
        .search-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .search-input {
            flex: 1;
            max-width: 600px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s, background-color 0.3s;
        }
        .search-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        .search-input::placeholder {
            color: #999;
        }
        .search-info {
            font-size: 0.9rem;
            color: #666;
            margin-left: 1rem;
        }
        body.theme-dark .search-info {
            color: #aaa;
        }
        .no-results {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-style: italic;
        }
        body.theme-dark .no-results {
            color: #aaa;
        }
        
        /* Mobile responsive fixes */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            
            .search-container {
                flex: 1 1 100% !important;
                min-width: 0 !important;
                max-width: none !important;
                margin: 0 !important;
                width: 100% !important;
            }
            
            .search-input {
                width: 100%;
                max-width: none;
                box-sizing: border-box;
            }
            
            .random-game-btn {
                font-size: 0.9rem;
                padding: 0.6rem 1rem;
                white-space: nowrap;
                min-width: auto;
                width: auto;
            }
            
            .theme-toggle {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
                min-width: auto;
                width: auto;
            }
            
            #back-home-btn {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
                white-space: nowrap;
                min-width: auto;
                width: auto;
            }
            
            #header-container {
                gap: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            #header-buttons {
                gap: 0.3rem !important;
            }
        }
        
        /* Extra small mobile devices */
        @media (max-width: 480px) {
            body {
                padding: 0.3rem;
            }
            
            .search-container {
                margin-bottom: 0.8rem !important;
            }
            
            .random-game-btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }
            
            .theme-toggle {
                font-size: 0.7rem;
                padding: 0.3rem 0.6rem;
            }
            
            #back-home-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            
            /* Ensure header text wraps properly */
            .header-content h1 {
                font-size: 1.2rem;
                line-height: 1.3;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .header-content h2 {
                font-size: 1rem;
                line-height: 1.3;
                word-break: break-word;
                overflow-wrap: break-word;
            }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
            .header-content h1 {
                font-size: 1.1rem;
            }
            
            .header-content h2 {
                font-size: 0.9rem;
            }
        }
        
        /* Smooth transitions for show/hide */
        #header-container, #header-content {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        #header-container[style*="display: none"], #header-content[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }
        
        /* Prevent layout shifts and scrollbar appearance */
        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        /* Ensure grid layout remains stable */
        .grid {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            display: block;
        }
        
        /* Section headers styling */
        .section-header {
            margin: 1rem 0 0.5rem 0;
            padding: 0.3rem 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--background);
            z-index: 10;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 3rem;
            font-weight: bold;
            color: var(--text-color);
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .section-games {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.8rem;
            margin-bottom: 0.5rem;
            width: 100%;
        }
        
        /* Responsive section adjustments */
        @media (max-width: 768px) {
            .section-header {
                margin: 0.8rem 0 0.4rem 0;
                padding: 0.2rem 0;
            }
            
            .section-header h2 {
                font-size: 2.2rem;
                letter-spacing: 2px;
            }
            
            .section-games {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 12px;
                margin-bottom: 0.3rem;
                width: 100%;
            }
        }
        
        /* Prevent any horizontal overflow */
        * {
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* Ensure header content doesn't overflow */
        .header-content {
            width: 100%;
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }
        
        .header-content h1,
        .header-content h2 {
            width: 100%;
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
            margin: 0;
            padding: 0;
        }
        
        /* Responsive grid adjustments - match main index.html */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 15px;
                width: 100%;
                max-width: 100%;
            }
        }
        
        /* Fix banner spacer styling */
        #bonjourarcade-banner-spacer {
            background: transparent !important;
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            display: block !important;
            max-width: 100vw !important;
            overflow: hidden !important;
        }
        
        /* Ensure banner doesn't cause visual artifacts */
        .bonjourarcade-banner {
            background: #3460e5 !important;
            border: none !important;
            margin: 0 !important;
            padding: 12px 0 !important;
            width: 100% !important;
            max-width: 100vw !important;
            overflow: hidden !important;
        }
        
        /* Container constraints */
        #header-container,
        .search-container,
        #header-content,
        #browser-warning,
        #gameGrid {
            width: 100% !important;
            max-width: 100% !important;
            overflow: hidden !important;
            box-sizing: border-box !important;
        }
        
        /* Hide tooltips on mobile devices */
        @media (max-width: 768px) {
            .game-meta-tooltip {
                display: none !important;
                opacity: 0 !important;
                visibility: hidden !important;
            }
        }
    </style>
    <style>
    .game-meta-tooltip {
        z-index: 9999 !important;
        position: fixed !important;
        pointer-events: none;
        background: rgba(24, 24, 24, 0.92) !important;
        color: #fff !important;
        border-radius: 10px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.28);
        padding: 18px 22px;
        min-width: 180px;
        max-width: 340px;
        font-size: 1.08em;
        font-family: inherit;
        opacity: 0.98;
        transition: opacity 0.15s;
    }
    .game-meta-table .meta-label {
        color: #fff !important;
    }
    .game-meta-table .meta-value {
        color: #fff !important;
    }
    </style>
</head>
<body>
    <div id="header-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
        <button id="back-home-btn" style="padding: 0.6rem 1.2rem; font-size: 1rem; border-radius: 6px; border: none; background: #222; color: #fff; cursor: pointer; font-family: sans-serif; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">← Retour Accueil</button>
        
        <div class="search-container" style="margin-bottom: 0; flex: 1; min-width: 250px; max-width: 600px; margin-left: 0; margin-right: 0;">
            <select id="search-type" style="padding: 0.75rem 0.5rem; border: 2px solid var(--border-color); border-radius: 8px 0 0 8px; font-size: 1rem; background: var(--card-bg); color: var(--text-color); border-right: none; cursor: pointer;">
                <option value="title">Titre</option>
                <option value="genre">Genre</option>
            </select>
            <input type="text" id="search-input" class="search-input" placeholder="Rechercher par titre..." style="border-radius: 0 8px 8px 0; border-left: none;">
            <select id="genre-select" style="display: none; padding: 0.75rem 1rem; border: 2px solid var(--border-color); border-radius: 0 8px 8px 0; font-size: 1rem; background: var(--card-bg); color: var(--text-color); border-left: none; cursor: pointer;">
                <option value="">Sélectionner un genre...</option>
            </select>
            <span class="search-info" id="search-info"></span>
        </div>
        
        <div id="header-buttons" style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
            <button id="theme-toggle" class="theme-toggle" style="margin-right: 0;">🌙</button>
            <button id="random-game-btn" class="random-game-btn">Jouer à un jeu aléatoire</button>
        </div>
    </div>
    
    <div id="header-content" class="header-content">
        <div class="header-left">
            <div>
                <h1>Tu as trouvé la cachette secrète de jeux!</h1>
                <h2>Lequel vas-tu essayer en premier?</h2>
            </div>
        </div>
    </div>

    <div id="browser-warning" class="browser-warning">
        <p><strong>Note :</strong> Pour une expérience de jeu optimale, nous vous recommandons d'utiliser un navigateur basé sur Chromium comme Google Chrome, Microsoft Edge ou Brave. Certains jeux peuvent ne pas fonctionner de manière optimale dans votre navigateur actuel.</p>
    </div>

    <div class="grid" id="gameGrid"></div>

    <script src="/assets/js/banner.js"></script>
    <script>
        // Store all games data globally
        let gamesData = [];
        let filteredGamesData = [];
        
        // Back to home button
        document.getElementById('back-home-btn').addEventListener('click', function() {
            window.location.href = '/index.html';
        });
        
        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('theme-dark');
                document.getElementById('theme-toggle').textContent = '☀️';
            } else {
                document.body.classList.remove('theme-dark');
                document.getElementById('theme-toggle').textContent = '🌙';
            }
        }

        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('theme-toggle');
            
            if (body.classList.contains('theme-dark')) {
                body.classList.remove('theme-dark');
                localStorage.setItem('theme', 'light');
                toggle.textContent = '🌙';
            } else {
                body.classList.add('theme-dark');
                localStorage.setItem('theme', 'dark');
                toggle.textContent = '☀️';
            }
        }

        // Search functionality
        function filterGames(searchTerm) {
            if (!searchTerm) {
                filteredGamesData = gamesData;
                updateSearchInfo();
                renderGames(filteredGamesData);
                showHeaderElements(); // Show header elements when search is cleared
                showSectionHeaders(); // Show section headers when search is cleared
                return;
            }
            
            const searchType = document.getElementById('search-type').value;
            const term = searchTerm.toLowerCase();
            
            // Filter based on search type
            filteredGamesData = gamesData.filter(game => {
                if (searchType === 'title') {
                    // Search only by title
                    let displayTitle = game.title;
                    if (!displayTitle || displayTitle === game.id) {
                        displayTitle = capitalizeFirst(game.id);
                    }
                    return displayTitle.toLowerCase().includes(term);
                } else if (searchType === 'genre') {
                    // Search only by genre (exact match from dropdown, case insensitive)
                    // Check if any of the comma-separated genres match
                    if (game.genre) {
                        const individualGenres = game.genre.split(',').map(g => g.trim().toLowerCase());
                        return individualGenres.includes(term.toLowerCase());
                    }
                    return false;
                }
                return false;
            });
            
            updateSearchInfo();
            renderGames(filteredGamesData);
            hideHeaderElements(); // Hide header elements when searching
            hideSectionHeaders(); // Hide section headers when searching
        }
        
        function showHeaderElements() {
            const headerContainer = document.getElementById('header-container');
            const headerContent = document.getElementById('header-content');
            if (headerContainer) headerContainer.style.display = 'flex';
            if (headerContent) headerContent.style.display = 'block';
        }
        
        function hideHeaderElements() {
            const headerContainer = document.getElementById('header-container');
            const headerContent = document.getElementById('header-content');
            if (headerContainer) headerContainer.style.display = 'none';
            if (headerContent) headerContent.style.display = 'none';
        }
        
        function showSectionHeaders() {
            const sectionHeaders = document.querySelectorAll('.section-header');
            sectionHeaders.forEach(header => {
                header.style.display = 'block';
            });
        }
        
        function hideSectionHeaders() {
            const sectionHeaders = document.querySelectorAll('.section-header');
            sectionHeaders.forEach(header => {
                header.style.display = 'none';
            });
        }
        
        function updateSearchInfo() {
            const searchInfo = document.getElementById('search-info');
            if (filteredGamesData.length === gamesData.length) {
                searchInfo.textContent = '';
            } else {
                searchInfo.textContent = `${filteredGamesData.length} jeu${filteredGamesData.length > 1 ? 'x' : ''} trouvé${filteredGamesData.length > 1 ? 's' : ''}`;
            }
        }
        
        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function renderGames(games) {
            const container = document.getElementById('gameGrid');
            container.innerHTML = '';
            
            if (games.length === 0) {
                container.innerHTML = '<div class="no-results">Aucun jeu ne correspond à votre recherche</div>';
                return;
            }
            
            // Check if we're in search mode (no sections when searching)
            const searchInput = document.getElementById('search-input');
            const genreSelect = document.getElementById('genre-select');
            const isSearching = (searchInput && searchInput.value) || (genreSelect && genreSelect.value);
            
            if (isSearching) {
                // Simple grid layout for search results (no sections)
                const searchGrid = document.createElement('div');
                searchGrid.className = 'section-games';
                searchGrid.style.width = '100%';
                searchGrid.style.display = 'grid';
                
                // Responsive grid template columns
                if (window.innerWidth <= 768) {
                    searchGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(100px, 1fr))';
                    searchGrid.style.gap = '12px';
                    searchGrid.style.marginBottom = '0.3rem';
                } else {
                    searchGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
                    searchGrid.style.gap = '0.8rem';
                    searchGrid.style.marginBottom = '0.5rem';
                }
                
                // Sort games alphabetically for search results
                games.sort((a, b) => {
                    let titleA = a.title;
                    let titleB = b.title;
                    if (!titleA || titleA === a.id) titleA = capitalizeFirst(a.id);
                    if (!titleB || titleB === b.id) titleB = capitalizeFirst(b.id);
                    return titleA.localeCompare(titleB);
                });
                
                // Render all games in the search grid
                games.forEach(game => {
                    const div = document.createElement('div');
                    div.className = 'game';
                    div._gameData = game;

                    let coverSrc = game.coverArt || '/assets/images/placeholder_thumb.png';

                    // Use thumbnail version if available
                    if (coverSrc && coverSrc !== '/assets/images/placeholder_thumb.png') {
                        const lastDotIndex = coverSrc.lastIndexOf('.');
                        if (lastDotIndex !== -1) {
                            coverSrc = coverSrc.substring(0, lastDotIndex) + '_thumb' + coverSrc.substring(lastDotIndex);
                        }
                    }

                    // Add special border and badge if new_flag is true
                    if (game.new_flag === 'true') {
                        div.classList.add('game-new');
                    }

                    div.innerHTML = `
                        <a href="${game.pageUrl}" class="game-link">
                            <div class="game-cover" style="position:relative;">
                                ${game.new_flag === 'true' ? '<span class="new-badge">NOUVEAU</span>' : ''}
                                <img src="${coverSrc}" alt="${game.title}">
                            </div>
                            <div class="game-title">${game.title}</div>
                        </a>
                    `;
                    
                    // Add click handler to set referrer flag
                    div.querySelector('a').addEventListener('click', function(e) {
                        sessionStorage.setItem('referrerAllGames', '1');
                    });

                    // Tooltip event listeners - only on non-mobile devices
                    if (!isMobileDevice()) {
                        div.addEventListener('mouseenter', (e) => {
                            showTooltipForItem(div);
                        });
                        div.addEventListener('mouseleave', (e) => {
                            removeTooltip();
                        });
                    }

                    searchGrid.appendChild(div);
                });
                
                container.appendChild(searchGrid);
            } else {
                // Original sectioned layout for browsing (when not searching)
                // Group games by first letter
                const gamesByLetter = {};
                games.forEach(game => {
                    let displayTitle = game.title;
                    if (!displayTitle || displayTitle === game.id) {
                        displayTitle = capitalizeFirst(game.id);
                    }
                    const firstChar = displayTitle.charAt(0).toUpperCase();
                    
                    // Group numbers into "#" category
                    let category = firstChar;
                    if (/[0-9]/.test(firstChar)) {
                        category = '#';
                    }
                    
                    if (!gamesByLetter[category]) {
                        gamesByLetter[category] = [];
                    }
                    gamesByLetter[category].push(game);
                });
                
                // Sort letters alphabetically, but put "#" at the beginning
                const sortedLetters = Object.keys(gamesByLetter).sort((a, b) => {
                    if (a === '#') return -1;
                    if (b === '#') return 1;
                    return a.localeCompare(b);
                });
                
                // Render each section
                sortedLetters.forEach(letter => {
                    // Create section header
                    const sectionHeader = document.createElement('div');
                    sectionHeader.className = 'section-header';
                    sectionHeader.innerHTML = `<h2>${letter}</h2>`;
                    container.appendChild(sectionHeader);
                    
                    // Create section container with full width
                    const sectionContainer = document.createElement('div');
                    sectionContainer.className = 'section-games';
                    sectionContainer.style.width = '100%';
                    sectionContainer.style.display = 'grid';
                    
                    // Responsive grid template columns
                    if (window.innerWidth <= 768) {
                        sectionContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(100px, 1fr))';
                        sectionContainer.style.gap = '12px';
                        sectionContainer.style.marginBottom = '0.3rem';
                    } else {
                        sectionContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
                        sectionContainer.style.gap = '0.8rem';
                        sectionContainer.style.marginBottom = '0.5rem';
                    }
                    
                    // Sort games within each section alphabetically
                    gamesByLetter[letter].sort((a, b) => {
                        let titleA = a.title;
                        let titleB = b.title;
                        if (!titleA || titleA === a.id) titleA = capitalizeFirst(a.id);
                        if (!titleB || titleB === b.id) titleB = capitalizeFirst(b.id);
                        return titleA.localeCompare(titleB);
                    });
                    
                    // Render games in this section
                    gamesByLetter[letter].forEach(game => {
                        const div = document.createElement('div');
                        div.className = 'game';
                        div._gameData = game;

                        let coverSrc = game.coverArt || '/assets/images/placeholder_thumb.png';

                        // Use thumbnail version if available
                        if (coverSrc && coverSrc !== '/assets/images/placeholder_thumb.png') {
                            const lastDotIndex = coverSrc.lastIndexOf('.');
                            if (lastDotIndex !== -1) {
                                coverSrc = coverSrc.substring(0, lastDotIndex) + '_thumb' + coverSrc.substring(lastDotIndex);
                            }
                        }

                        // Add special border and badge if new_flag is true
                        if (game.new_flag === 'true') {
                            div.classList.add('game-new');
                        }

                        div.innerHTML = `
                            <a href="${game.pageUrl}" class="game-link">
                                <div class="game-cover" style="position:relative;">
                                    ${game.new_flag === 'true' ? '<span class="new-badge">NOUVEAU</span>' : ''}
                                    <img src="${coverSrc}" alt="${game.title}">
                                </div>
                                <div class="game-title">${game.title}</div>
                            </a>
                        `;
                        
                        // Add click handler to set referrer flag
                        div.querySelector('a').addEventListener('click', function(e) {
                            sessionStorage.setItem('referrerAllGames', '1');
                        });

                        // Tooltip event listeners - only on non-mobile devices
                        if (!isMobileDevice()) {
                            div.addEventListener('mouseenter', (e) => {
                                showTooltipForItem(div);
                            });
                            div.addEventListener('mouseleave', (e) => {
                                removeTooltip();
                            });
                        }

                        sectionContainer.appendChild(div);
                    });
                    
                    container.appendChild(sectionContainer);
                });
            }
        }

        // Function to select a random game from the list
        function playRandomGame() {
            if (gamesData.length > 0) {
                const randomIndex = Math.floor(Math.random() * gamesData.length);
                const randomGame = gamesData[randomIndex];
                sessionStorage.setItem('referrerAllGames', '1');
                window.location.href = randomGame.pageUrl;
            } else {
                console.error('No games available to select from');
            }
        }

        // Check if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }

        // Focus search function
        function focusSearch() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.focus();
                searchInput.select();
            }
        }

        // Detect if browser is Chromium-based
        function isChromiumBased() {
            const userAgent = navigator.userAgent.toLowerCase();
            return userAgent.includes('chrome') ||
                   userAgent.includes('chromium') ||
                   userAgent.includes('edg') ||
                   userAgent.includes('brave');
        }

        // Check browser and show warning if needed
        function checkBrowser() {
            if (!isChromiumBased()) {
                document.getElementById('browser-warning').style.display = 'block';
            }
        }

        // Add event listeners
        document.getElementById('random-game-btn').addEventListener('click', playRandomGame);
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        
        // Search input event listener
        document.getElementById('search-input').addEventListener('input', (e) => {
            filterGames(e.target.value);
        });
        
        // Search type dropdown event listener
        document.getElementById('search-type').addEventListener('change', (e) => {
            const searchInput = document.getElementById('search-input');
            const genreSelect = document.getElementById('genre-select');
            const searchType = e.target.value;
            
            // Update placeholder text and show/hide appropriate input
            if (searchType === 'title') {
                searchInput.placeholder = 'Rechercher par titre...';
                searchInput.style.display = 'block';
                genreSelect.style.display = 'none';
                searchInput.value = '';
                genreSelect.value = '';
            } else if (searchType === 'genre') {
                searchInput.style.display = 'none';
                genreSelect.style.display = 'block';
                searchInput.value = '';
                genreSelect.value = '';
                
                // Populate genre select with unique genres from gamesData (case-insensitive deduplication and comma splitting)
                const genreMap = new Map();
                gamesData.forEach(game => {
                    if (game.genre) {
                        // Split genres by comma and trim whitespace
                        const individualGenres = game.genre.split(',').map(g => g.trim());
                        individualGenres.forEach(subGenre => {
                            if (subGenre) { // Ensure subGenre is not empty after trimming
                                const lowerSubGenre = subGenre.toLowerCase();
                                if (!genreMap.has(lowerSubGenre)) {
                                    genreMap.set(lowerSubGenre, subGenre); // Keep original case for display
                                }
                            }
                        });
                    }
                });
                const uniqueGenres = Array.from(genreMap.values()).sort();
                genreSelect.innerHTML = '<option value="">Sélectionner un genre...</option>';
                uniqueGenres.forEach(genre => {
                    const option = document.createElement('option');
                    option.value = genre;
                    option.textContent = genre;
                    genreSelect.appendChild(option);
                });
            }
            
            // Clear any existing search results
            filterGames('');
        });
        
        // Genre select event listener
        document.getElementById('genre-select').addEventListener('change', (e) => {
            filterGames(e.target.value);
        });

        // Keyboard event listener for "/" key
        document.addEventListener('keydown', function(e) {
            // If search is focused, handle Escape key
            if (document.activeElement === document.getElementById('search-input')) {
                if (e.key === 'Escape') {
                    const searchInput = document.getElementById('search-input');
                    searchInput.value = '';
                    searchInput.blur();
                    filterGames('');
                    e.preventDefault();
                }
                return;
            }
            
            // Focus search bar on "/" key
            if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
                focusSearch();
                e.preventDefault();
            }
            
            // Jump to section on letter key press
            if (!e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey) {
                const key = e.key.toLowerCase();
                
                // Check if it's a letter (a-z) or number (0-9)
                if ((key >= 'a' && key <= 'z') || (key >= '0' && key <= '9')) {
                    jumpToSection(key);
                    e.preventDefault();
                }
            }
        });
        
        // Function to jump to a specific section
        function jumpToSection(letter) {
            // Convert number to '#' for number section
            const sectionLetter = /[0-9]/.test(letter) ? '#' : letter.toUpperCase();
            
            // Find the section header
            const sectionHeaders = document.querySelectorAll('.section-header h2');
            let targetSection = null;
            
            sectionHeaders.forEach(header => {
                if (header.textContent === sectionLetter) {
                    targetSection = header.closest('.section-header');
                }
            });
            
            if (targetSection) {
                // Scroll to the section with smooth animation
                targetSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
                // Clear any existing highlights
                document.querySelectorAll('.section-header').forEach(header => {
                    header.style.backgroundColor = '';
                    header.style.boxShadow = '';
                });
                
                // Add a prominent highlight effect
                targetSection.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';
                targetSection.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.3)';
                targetSection.style.transition = 'background-color 0.3s ease, box-shadow 0.3s ease';
                
                // Also highlight the section title
                const sectionTitle = targetSection.querySelector('h2');
                if (sectionTitle) {
                    sectionTitle.style.color = '#2e7d32';
                    sectionTitle.style.textShadow = '0 0 10px rgba(46, 125, 50, 0.5)';
                    sectionTitle.style.transition = 'color 0.3s ease, text-shadow 0.3s ease';
                }
                
                setTimeout(() => {
                    targetSection.style.backgroundColor = '';
                    targetSection.style.boxShadow = '';
                    if (sectionTitle) {
                        sectionTitle.style.color = '';
                        sectionTitle.style.textShadow = '';
                    }
                }, 1500);
            }
        }

        // Initialize theme and check browser when page loads
        window.addEventListener('DOMContentLoaded', () => {
            initTheme();
            checkBrowser();
        });

        // Fetch and render games
        fetch('/gamelist.json')
            .then(res => res.json())
            .then(data => {
                // Combine gameOfTheWeek and previousGames
                gamesData = [];
                if (data.gameOfTheWeek) gamesData.push(data.gameOfTheWeek);
                if (Array.isArray(data.previousGames)) gamesData = gamesData.concat(data.previousGames);

                // Sort games alphabetically by title
                gamesData.sort((a, b) => {
                    return a.title.localeCompare(b.title);
                });
                
                // Initialize filtered games with all games
                filteredGamesData = gamesData;
                
                // Render all games initially
                renderGames(gamesData);
            })
            .catch(err => {
                console.error('Error loading games.json:', err);
                document.getElementById('gameGrid').textContent = "Échec du chargement des données de jeu.";
            });
    </script>
    <script>
    // --- Tooltip Functions (adapted from main.js) ---
    function summarizeControls(controls) {
        if (!controls || !Array.isArray(controls)) return '';
        const joystickLines = controls.filter(line => String(line).trim().startsWith('🕹️'));
        if (joystickLines.length >= 2) return '🕹️🕹️';
        let summary = '';
        for (let line of controls) {
            line = String(line).trim();
            if (!line) continue;
            let first = line.split(' ')[0];
            if ([
                '1️⃣','2️⃣','3️⃣','4️⃣','5️⃣','6️⃣','7️⃣','8️⃣','9️⃣','0️⃣'
            ].includes(first)) {
                first = '🔴';
            }
            summary += first + ' ';
        }
        return summary.trim();
    }

    function showTooltipForItem(item) {
        removeTooltip(); // Clear any existing tooltip
        if (!item) return;
        let game = item._gameData;
        if (!game) return;
        const tooltip = document.createElement('div');
        tooltip.id = 'game-meta-tooltip';
        tooltip.className = 'game-meta-tooltip';
        const fields = [
            { label: 'Développeur', key: 'developer' },
            { label: 'Année', key: 'year' },
            { label: 'Système', key: 'system' },
            { label: 'Genre', key: 'genre' },
            { label: 'Recommandé par', key: 'recommended' },
            { label: 'Ajouté', key: 'added' }
        ];
        let hasData = false;
        const table = document.createElement('table');
        table.className = 'game-meta-table';
        fields.forEach(field => {
            if (game[field.key]) {
                hasData = true;
                const row = document.createElement('tr');
                const labelCell = document.createElement('td');
                labelCell.innerHTML = `<strong>${field.label}:</strong>`;
                labelCell.className = 'meta-label';
                const valueCell = document.createElement('td');
                valueCell.textContent = game[field.key];
                valueCell.className = 'meta-value';
                row.appendChild(labelCell);
                row.appendChild(valueCell);
                table.appendChild(row);
            }
        });
        if (game.controls && summarizeControls(game.controls)) {
            hasData = true;
            const row = document.createElement('tr');
            const labelCell = document.createElement('td');
            labelCell.innerHTML = `<strong>Contrôles:</strong>`;
            labelCell.className = 'meta-label';
            const valueCell = document.createElement('td');
            valueCell.textContent = summarizeControls(game.controls);
            valueCell.className = 'meta-value';
            row.appendChild(labelCell);
            row.appendChild(valueCell);
            table.appendChild(row);
        }
        if (hasData) {
            tooltip.appendChild(table);
            document.body.appendChild(tooltip);
            // Position tooltip near the item (fixed coordinates)
            const rect = item.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            let left = rect.right + 8;
            let top = rect.top;
            if (left + tooltipRect.width > window.innerWidth) {
                left = rect.left - tooltipRect.width - 8;
            }
            if (top + tooltipRect.height > window.innerHeight) {
                top = window.innerHeight - tooltipRect.height - 8;
            }
            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${top}px`;
        }
    }

    function removeTooltip() {
        const tooltip = document.getElementById('game-meta-tooltip');
        if (tooltip) tooltip.remove();
    }
    // Optional: Remove tooltip on click anywhere - only on non-mobile devices
    if (!isMobileDevice()) {
        document.addEventListener('click', removeTooltip);
    }
    </script>
</body>
</html>
